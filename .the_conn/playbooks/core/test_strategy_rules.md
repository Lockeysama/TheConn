# 测试策略规范

本文档定义 The Conn 框架中的测试策略和 Story 类型判断规则。

---

## Story 类型与测试策略

| Story 类型     | 验收标准 | 测试策略       | 判断依据                          |
| -------------- | -------- | -------------- | --------------------------------- |
| 用户功能 Story | BDD 场景 | BDD + 单元测试 | 有用户界面交互或业务流程          |
| 技术实现 Story | 技术清单 | 单元测试       | 技术基础设施、工具、框架配置      |
| Bug 修复 Story | 回归验证 | 单元 + 回归    | 修复已有功能的缺陷                |
| Feature E2E    | BDD 场景 | E2E 集成测试   | 多 Story 集成测试，Feature 完成后 |
| 性能测试       | 性能指标 | 性能测试       | 有性能要求或性能瓶颈风险的功能点  |

---

## Story 类型判断标准

### 1. 用户功能 Story（需要 BDD）

**特征**：
- ✅ 有用户可见的行为变化
- ✅ 涉及业务流程或用户交互
- ✅ 需要从用户角度验收

**示例**：
- 用户登录功能
- 订单提交流程
- 数据展示页面
- API 端点（对外提供服务）

### 2. 技术实现 Story（仅单元测试）

**特征**：
- ✅ 用户不可见的技术实现
- ✅ 基础设施、工具、框架
- ✅ 内部技术优化

**示例**：
- 缓存层实现
- 日志框架配置
- 数据库连接池
- 内部工具类/辅助函数

### 3. Bug 修复 Story

**特征**：
- ✅ 修复已有功能的缺陷
- ✅ 需要回归测试验证

---

## Feature E2E 测试决策

**多维度评估模型**（需满足任意一条）：

| 维度       | 触发条件                     | 权重 |
| ---------- | ---------------------------- | ---- |
| 功能完整性 | Feature 包含完整的用户流程   | 高   |
| 集成复杂度 | 涉及 3+ 个模块/服务交互      | 高   |
| 任务复杂度 | Story 平均复杂度 ≥ 5.0       | 中   |
| 风险等级   | 核心业务功能、支付、安全相关 | 高   |
| 用户可见度 | 5+ 个用户功能 Story          | 中   |
| Story 数量 | Feature 包含 6+ 个 Story     | 低   |

**决策规则**：
- 高权重触发 1 条 → 建议 E2E 测试
- 中权重触发 2 条 → 建议 E2E 测试
- 低权重触发 + 其他 → 建议 E2E 测试

---

## 性能测试决策

**触发条件**（满足任意一条）：
- 预期有高并发场景
- 涉及大数据量处理
- 有明确的性能指标要求
- 存在已知的性能瓶颈风险

**测试时机**：Feature 功能开发完成后，单独排性能测试 Story

---

**最后更新**: 2025-12-16

