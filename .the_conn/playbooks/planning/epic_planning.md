# Epic 规划生成指南

根据需求文档生成 Epic 规划文件。

## ⚠️ 重要：遵守基础公约

**本 Playbook 严格遵守 `@rules/base_rules.md` 中定义的所有基础公约。**

**📋 规范引用**：

本 Playbook 依赖以下规范文件（AI 必须先加载）：
- **基础公约**: `@rules/base_rules.md` - 禁止事项、文件路径约定、质量标准
- **测试策略**: `@rules/test_strategy_rules.md` - Story 类型判断、测试决策规则

## 本 Playbook 的工作范围

**专注于**：生成 Epic 规划文档（创建 Epic README.md 文件）

**自动初始化**：
- AI 会自动检测 Epic 目录是否已存在
- 如果目录不存在，会先调用 `epic_init.md` 创建目录结构
- 然后生成 Epic 规划内容
- 用户无需手动执行 `tc epic-init`

**使用说明**：
- **推荐**：直接使用 `tc epic <名称>`，AI 会自动处理初始化
- **高级用法**：如果只需要创建目录结构而不生成规划内容，可以使用 `tc plan epic-init <名称>`

---

## 命名与格式规范

### ID 命名规则

- **格式**: `EPIC-{序号}`
- **序号**: 全局唯一，两位数字，从 01 开始
- **示例**: `EPIC-01`, `EPIC-02`, `EPIC-10`

### 目录命名规则

- **格式**: `EPIC-{序号}_{PascalCaseName}`
- **PascalCase**: 每个单词首字母大写，无分隔符
- **示例**: `EPIC-01_Base_Init`, `EPIC-02_DataStream`

### 文件路径

```
.the_conn/epics/EPIC-{序号}_{PascalCaseName}/README.md
```

**示例**: `.the_conn/epics/EPIC-01_Base_Init/README.md`

### Frontmatter 规范

```yaml
---
id: EPIC-01
status: pending
created: yyyy-mm-dd
depends_on: []
---
```

**字段说明**：

- `status`: `pending` (未完成) 或 `done` (已完成)
- `created`: 格式 `yyyy-mm-dd`
- `depends_on`: 依赖的其他 Epic ID 列表，无依赖写 `[]`

---

## 输出格式

```markdown
# EPIC-{序号}: {Epic 名称}

- **业务价值**: {一句话说明核心价值}
- **范围**: {包含的功能模块}
- **关键指标**: {可衡量的成功指标}
- **创建日期**: {yyyy-mm-dd}
```

---

## 生成原则

1. **业务价值**: 清晰、可量化，从用户/业务视角描述
2. **范围边界**: 明确包含哪些功能模块，不包含哪些
3. **关键指标**: 必须可通过数据验证（如功能数量、性能指标、测试覆盖率）
4. **命名规范**: Epic 名称使用 PascalCase
5. **粒度控制**: 默认使用较粗的粒度，按大的业务领域划分，避免 Epic 过多过细
6. **测试战略**: 规划 Epic 级别的测试里程碑，确保整体质量保障
7. **依赖关系**: 明确 Epic 之间的依赖关系和建议顺序

---

## Epic 粒度控制标准

**核心原则**：默认使用较粗的粒度，按大的业务领域划分，避免 Epic 过多过细。

### 合适的 Epic 粒度

| 维度         | 推荐范围 | 说明                                    |
| ------------ | -------- | --------------------------------------- |
| Feature 数量 | 3-5 个   | 核心范围，便于管理                      |
| Story 总数   | 8-25 个  | 避免过度碎片化                          |
| 复杂度总和   | 30-70 分 | 基于复杂度评分系统（1.0-10.0 分/Story） |

### Epic 过大的信号

- Feature 数量 > 7 个
- Story 总数 > 35 个
- 复杂度总和 > 90 分
- **建议**：拆分为多个 Epic

### Epic 过小的信号

- Feature 数量 < 2 个
- Story 总数 < 8 个
- 复杂度总和 < 20 分
- **建议**：合并到其他 Epic 或改为 Feature

### 拆分策略

**推荐：按业务领域拆分**
- ✅ 好例子：EPIC-01 用户管理、EPIC-02 商品管理、EPIC-03 订单管理
- ❌ 坏例子：EPIC-01 前端、EPIC-02 后端、EPIC-03 数据库

**技术架构拆分（仅限基础设施）**
- ✅ 好例子：EPIC-01 基础框架、EPIC-02 业务功能
- ❌ 坏例子：EPIC-01 数据库层、EPIC-02 缓存层、EPIC-03 API 层

**按用户旅程拆分**
- ✅ 好例子：EPIC-01 用户注册与认证、EPIC-02 完整购物流程
- ❌ 坏例子：EPIC-01 注册、EPIC-02 登录、EPIC-03 找回密码（过细）

### Story 粒度提示

⚠️ **避免 Story 过度碎片化**：
- 单个 Story 复杂度 < 2.0 分可能过于简单
- 考虑合并相关的小 Story
- 一个完整功能点应在一个 Story 内完成
- 优先按功能模块边界拆分，而非实现细节

---

## Epic 依赖关系规划

### 依赖关系类型

**1. 技术依赖**：
- 后续 Epic 需要前置 Epic 的技术基础
- 示例：EPIC-02（业务功能）依赖 EPIC-01（基础框架）

**2. 数据依赖**：
- 后续 Epic 需要前置 Epic 创建的数据结构
- 示例：EPIC-03（数据分析）依赖 EPIC-02（数据采集）

**3. 业务依赖**：
- 业务流程上的先后关系
- 示例：EPIC-03（支付）依赖 EPIC-02（订单）

**4. 资源依赖**：
- 共享相同的开发资源或环境
- 建议：避免过度并行，合理安排顺序

### 依赖关系表示

在 Epic 文档的 Frontmatter 中：

```yaml
---
id: EPIC-02
status: pending
created: 2025-12-22
depends_on:
  - EPIC-01  # 依赖基础框架
---
```

### 开发顺序建议

**输出格式**（在 Epic 规划文档末尾）：

```markdown
## Epic 依赖关系与开发顺序

**依赖关系**：
- EPIC-02 依赖 EPIC-01（技术依赖：需要基础框架）
- EPIC-03 依赖 EPIC-02（业务依赖：需要用户数据）

**建议开发顺序**：

```
阶段 1: EPIC-01 (基础设施)
         ↓
阶段 2: EPIC-02 (核心业务) ← 可并行 → EPIC-04 (辅助功能)
         ↓
阶段 3: EPIC-03 (高级功能)
```

**并行机会**：
- EPIC-02 和 EPIC-04 可并行开发（无直接依赖）
- 建议：优先 EPIC-02（核心业务）

**风险提示**：
- EPIC-01 是关键路径，延期将影响所有后续 Epic
- EPIC-03 依赖链最长，需要密切关注
```

---

## 测试里程碑规划规则

**📋 详细的测试决策规则参考**: `@playbooks/planning/feature_planning.md` 的"自动生成测试 Story"部分

### Epic 级 E2E 测试决策规则（判断树）

```
开始判断
    ↓
是否有跨 Feature 的完整用户旅程？
    ├─ 是 → ✅ 必须 Epic E2E
    └─ 否 ↓
    
Feature 之间是否有强依赖（数据流/业务流）？
    ├─ 是 → ✅ 必须 Epic E2E
    └─ 否 ↓
    
Epic 包含 ≥3 个 Feature？
    ├─ 是 → 💡 建议 Epic E2E
    └─ 否 → ❌ 无需 Epic E2E（Feature 级测试足够）
```

**判断标准**：
- **完整用户旅程**：用户操作跨越多个 Feature（如注册→登录→使用功能）
- **强依赖**：一个 Feature 的输出是另一个 Feature 的输入
- **Feature 数量**：≥3 个时建议增加 Epic 级验证

### Epic 级性能测试决策规则（判断树）

```
开始判断
    ↓
是否有明确的性能 SLA 要求？
    ├─ 是 → ✅ 必须性能测试
    └─ 否 ↓
    
是否涉及高并发场景？
    ├─ 是 → 💡 建议性能测试
    └─ 否 ↓
    
是否有已知的性能瓶颈风险？
    ├─ 是 → 💡 建议性能测试
    └─ 否 → ❌ 无需性能测试（按需添加）
```

### 生成的 Epic 文档中的测试输出格式

**规则**：
1. ✅ 只列出需要的测试 Story 及简要理由
2. ✅ 按功能开发顺序排列
3. ❌ 不包含详细的决策原理说明
4. ❌ 不包含时间规划（Week 1-2 等）

**输出格式**：

```markdown
## 测试里程碑

### Feature 级别测试
各 Feature 根据其特征规划测试 Story（详见各 Feature 规划）

### Epic 级别测试（如果需要）

**STORY-999: Epic_E2E_{EpicName}**
- **类型**: E2E 测试 (type: e2e_test)
- **目的**: 验证跨 Feature 的完整用户旅程
- **理由**: Epic 包含 3 个以上 Feature，需要验证端到端集成
- **测试路径**: `tests/bdd/features/{module}/epic_{name}_flow.feature`
- **执行顺序**: 所有 Feature 完成后

**STORY-997: Performance_{EpicName}**（如果需要）
- **类型**: 性能测试 (type: perf_test)
- **目的**: 验证系统整体性能表现
- **理由**: 存在高并发场景，需要验证系统容量
- **执行顺序**: 所有 Feature 完成后
```

---

## 示例

### 示例 1: 不需要 Epic 级测试的 Epic

```markdown
# EPIC-01: 基础初始化

- **业务价值**: 为用户提供标准化的项目结构，支撑后续 AI 辅助开发
- **范围**: 目录结构初始化、模板文件生成、CLI 工具
- **关键指标**: 目录结构创建成功率 100%，模板文件完整性 100%
- **创建日期**: 2025-12-11

## Features 概览

- FEAT-01: 初始化项目结构
- FEAT-02: 生成模板文件

## 测试里程碑

### Feature 级别测试
各 Feature 根据其特征规划测试 Story（详见各 Feature 规划）

### Epic 级别测试
无需 Epic 级别测试（仅 2 个独立 Feature，无跨 Feature 依赖）

## Epic 依赖关系与开发顺序

**依赖关系**：
- 无前置依赖（首个 Epic）

**建议开发顺序**：

```
EPIC-01 (基础初始化)
```

**并行机会**：
- 无（单一 Epic）

**风险提示**：
- 作为基础 Epic，需要优先完成以支撑后续开发
```

### 示例 2: 需要 Epic 级测试的 Epic

```markdown
# EPIC-02: 用户管理系统

- **业务价值**: 提供完整的用户生命周期管理能力
- **范围**: 用户注册、认证、权限、个人资料管理
- **关键指标**: 用户注册成功率 99.9%，认证响应时间 < 200ms
- **创建日期**: 2025-12-17

## Features 概览

- FEAT-01: 用户注册
- FEAT-02: 用户认证
- FEAT-03: 权限管理
- FEAT-04: 个人资料

## 测试里程碑

### Feature 级别测试
各 Feature 根据其特征规划测试 Story（详见各 Feature 规划）

### Epic 级别测试

**STORY-999: Epic_E2E_UserManagement**
- **类型**: E2E 测试 (type: e2e_test)
- **目的**: 验证从注册到使用完整用户旅程
- **理由**: Epic 包含 4 个强依赖的 Feature，需要验证端到端集成
- **测试路径**: `tests/bdd/features/user/epic_user_flow.feature`
- **执行顺序**: 所有 Feature 完成后

**STORY-997: Performance_UserAuth**
- **类型**: 性能测试 (type: perf_test)
- **目的**: 验证用户认证系统的性能表现
- **理由**: 认证是高频访问场景，需要验证并发容量
- **执行顺序**: FEAT-02 完成后

## Epic 依赖关系与开发顺序

**依赖关系**：
- 依赖 EPIC-01（技术依赖：需要基础框架和数据库连接）

**建议开发顺序**：

```
EPIC-01 (基础框架)
    ↓
EPIC-02 (用户管理) ← Feature 内部顺序: FEAT-01 → FEAT-02 → FEAT-03 → FEAT-04
```

**Feature 间依赖**：
- FEAT-02（认证）依赖 FEAT-01（注册）：需要用户数据
- FEAT-03（权限）依赖 FEAT-02（认证）：需要用户身份
- FEAT-04（资料）依赖 FEAT-02（认证）：需要用户身份

**并行机会**：
- FEAT-03 和 FEAT-04 可并行开发（都依赖 FEAT-02，但互不依赖）

**风险提示**：
- FEAT-02 是关键路径，延期将影响后续所有 Feature
- 认证模块是高风险模块，需要重点关注安全性
```

---

现在，请根据用户提供的需求文档生成 Epic 规划。
